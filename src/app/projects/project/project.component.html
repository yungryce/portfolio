<div class="container mx-auto px-4 py-8 bg-[var(--bg)] text-[var(--fg)]">
  <a routerLink="/projects" class="inline-flex items-center gap-2 text-sm mb-4 text-github-radical hover:underline">← Back to projects</a>

  <ng-container *ngIf="repo$ | async as r; else loading">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">{{ r?.name }}</h1>
      <div class="text-sm text-[var(--muted)]">
        <time [attr.datetime]="r?.updatedAt">Updated {{ r?.updatedAt | date:'medium' }}</time>
        · <span>{{ r?.type }}</span>
      </div>
    </header>

    <section class="mb-6">
      <p class="text-[var(--fg)]/80">{{ r?.description }}</p>
      <div class="mt-3 flex flex-wrap gap-2">
        <span *ngFor="let tech of r?.primaryStack" class="px-2 py-1 text-xs rounded bg-[var(--chip-bg)] text-[var(--chip-fg)]">{{ tech }}</span>
      </div>
    </section>

    <section class="mb-8">
      <div class="lang-bar bg-[var(--soft)]" role="progressbar" aria-label="Languages distribution">
        <span *ngFor="let l of r?.languagesPct; let i = index" class="lang-chunk" [style.width.%]="l.pct" [attr.data-i]="i" [title]="l.k + ' ' + l.pct + '%'"></span>
      </div>
      <div class="mt-2 flex flex-wrap gap-2 text-xs text-[var(--muted)]">
        <span *ngFor="let l of r?.languagesPct">{{ l.k }} {{ l.pct }}%</span>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-[240px_minmax(0,1fr)] gap-6">
      <nav *ngIf="toc.length" class="rounded border border-[var(--border)] bg-[var(--card)] p-4 h-max sticky top-4">
        <h2 class="text-sm font-semibold mb-2">Table of contents</h2>
        <ul class="space-y-1">
          <li *ngFor="let item of toc">
            <a [href]="'#' + item.id"
               [style.paddingLeft.px]="(item.level - 1) * 12"
               class="text-sm hover:underline text-[var(--muted)]">{{ item.text }}</a>
          </li>
        </ul>
      </nav>

      <article class="rounded border border-[var(--border)] bg-[var(--card)] p-4">
        <div class="readme-content" [innerHTML]="readmeHtml"></div>
        <div class="mt-6">
          <a *ngIf="r?.htmlUrl" class="inline-block px-4 py-2 rounded bg-[var(--primary)] text-[var(--primary-foreground)] hover:brightness-95" [href]="r.htmlUrl" target="_blank" rel="noopener">
            Open on GitHub
          </a>
        </div>
      </article>
    </section>
  </ng-container>

  <ng-template #loading>
    <div class="rounded-xl border border-[var(--border)] bg-[var(--card)] p-4 animate-pulse">
      <div class="h-8 w-1/2 rounded bg-[var(--soft)] mb-3"></div>
      <div class="h-4 w-full rounded bg-[var(--soft)] mb-2"></div>
      <div class="h-4 w-5/6 rounded bg-[var(--soft)] mb-6"></div>
      <div class="h-2 w-full rounded bg-[var(--soft)]"></div>
    </div>
  </ng-template>
</div>
