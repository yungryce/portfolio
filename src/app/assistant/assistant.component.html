<div class="container mx-auto px-4 py-8 bg-[var(--bg)] text-[var(--fg)] transition-colors">
  <h1 class="text-3xl font-extrabold tracking-tight mb-4">Assistant</h1>

  <div class="rounded-lg border border-[var(--border)] bg-[var(--card)] p-4 mb-6">
    <label for="query" class="block text-sm font-medium text-[var(--muted)] mb-2">Ask about the portfolio</label>
    <textarea id="query" [(ngModel)]="query" rows="3"
              class="w-full px-3 py-2 rounded-md border border-[var(--border)] bg-[var(--bg)] text-[var(--fg)] focus:outline-none focus:ring-2 focus:ring-[var(--ring)]"
              placeholder="e.g., Show projects that use Flask and SQLAlchemy"></textarea>
    <div class="mt-3 flex gap-3">
      <button (click)="ask()" class="px-4 py-2 rounded bg-[var(--primary)] text-[var(--primary-foreground)] hover:brightness-95"
              [disabled]="loading">Ask</button>
      <button (click)="clear()" class="px-4 py-2 rounded bg-[var(--soft)] hover:brightness-95" [disabled]="loading">Clear</button>
    </div>
    <p *ngIf="error" class="mt-2 text-sm text-red-500">{{ error }}</p>
  </div>

  <div *ngIf="loading" class="rounded-lg border border-[var(--border)] bg-[var(--card)] p-4 animate-pulse">
    <div class="h-4 w-32 rounded bg-[var(--soft)] mb-3"></div>
    <div class="h-4 w-full rounded bg-[var(--soft)] mb-2"></div>
    <div class="h-4 w-5/6 rounded bg-[var(--soft)] mb-2"></div>
    <div class="h-4 w-3/4 rounded bg-[var(--soft)]"></div>
  </div>

  <div *ngIf="repositoriesUsed.length" class="rounded-lg border border-[var(--border)] bg-[var(--card)] p-4 mb-6">
    <h2 class="text-sm font-semibold mb-2">Repositories used</h2>
    <div class="flex flex-wrap gap-2 text-sm">
      <span *ngFor="let r of repositoriesUsed" class="px-2 py-1 rounded bg-[var(--chip-bg)] text-[var(--chip-fg)]">
        {{ r.name }} <span class="text-[var(--muted)]">({{ r.relevance_score | number:'1.2-2' }})</span>
      </span>
    </div>
  </div>

  <article *ngIf="answerHtml" class="rounded-lg border border-[var(--border)] bg-[var(--card)] p-4">
    <div class="prose max-w-none [&_*]:text-[var(--fg)]" [innerHTML]="answerHtml"></div>
  </article>
</div>
